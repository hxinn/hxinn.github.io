(()=>{"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function n(n){for(var o=1;o<arguments.length;o++){var s=null!=arguments[o]?arguments[o]:{};o%2?t(Object(s),!0).forEach((function(t){e(n,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):t(Object(s)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(s,e))}))}return n}const o=(e,t)=>{window.vibesState=n(n({},window.vibesState||{}),{},{[e]:t})},s="vibes_host.774f81bd.css";function i(e,t){const n=t.querySelector('meta[name="'.concat(e,'"]'));return n&&n.getAttribute("content")||""}function r(){return i("a2z:mons_app_name",window.document)}function a(){return i("a2z:mons_site_name",window.document)}function c(){return i("anti-csrftoken-a2z",window.document)}function l(e){const t="a2z:vibesTreatment",n=e.getElementById(t);return n?n.getAttribute("value")||"":i(t,e)}class u{constructor(t){e(this,"storage",void 0),this.storage=t}get(e){const t=this.storage.getItem(e);if(!t)return null;let n;try{n=JSON.parse(t)}catch(o){throw new Error("Could not parse cache entry: ".concat(t))}return(new Date).getTime()>n.exp?(this.storage.removeItem(e),null):n.value}set(e,t,n){const o={value:t,exp:(new Date).getTime()+n};this.storage.setItem(e,JSON.stringify(o))}getJson(e){const t=this.get(e);return t?JSON.parse(t):null}setJson(e,t,n){const o=JSON.stringify(t);this.set(e,o,n)}}function d(e,t){window.ueLogError?window.ueLogError(e,{logLevel:"ERROR",attribution:"Vibes",message:t}):console.error(t,e)}let p,m={pulseQuestion:null,pulseEventId:null,requestId:null,monsSiteName:null,monsAppName:null,currentUrl:null,csrfToken:null};new Promise((e=>{p=e}));function w(){return m.pulseEventId}function g(){return m.monsSiteName}function h(){return m.monsAppName}function v(){return m.currentUrl||""}window.addEventListener("message",(e=>{const t=e.data;t&&"Vibes"===t.source&&"setPulseData"===t.action&&(m={pulseQuestion:t.data.pulseQuestion||null,pulseEventId:t.data.eventId||null,requestId:t.data.parentRequestId||null,monsSiteName:t.data.monsSiteName||null,monsAppName:t.data.monsAppName||null,currentUrl:t.data.currentUrl||null,csrfToken:t.data.csrfToken||null},p(m))})),setTimeout((()=>{m.pulseQuestion||m.pulseEventId||function(){try{window.parent.postMessage({source:"VibesIframe",action:"requestPulseData"},"*")}catch(e){console.error("Error requesting parent data:",e)}}()}),100);const b="VIBES_DESKTOP";class f{constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e(this,"host",void 0),e(this,"csrfToken",void 0),this.host=t,this.csrfToken=n}async getQuestion(e){try{const t=await fetch("".concat(this.host,"/pulse/v1/question"),{method:"POST",redirect:"error",headers:{Accept:"application/json","Content-Type":"application/json","anti-csrftoken-a2z":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({runtimeAttributes:{mons_site:a(),mons_app:r(),weblab:e},surveyClient:b})});return t.ok?await t.json():(d("Error getting question for seller","Error getting question for seller"),null)}catch(t){return d(t,"Error while fetching Pulse GetQuestion API"),null}}async submitResponse(e,t,n,o){try{const s=await fetch("".concat(this.host,"/pulse/v1/response"),{method:"POST",redirect:"error",headers:{Accept:"application/json","Content-Type":"application/json","anti-csrftoken-a2z":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({questionId:e,surveyClient:b,textResponse:o,rating:t,selectedResponseId:[n],responseMetadata:{mons_site:g(),mons_app:h(),url:v(),targeting_event_id:w()}})});return s.ok?await s.json():(d("Error submitting question response","Error submitting question response"),null)}catch(s){return d(s,"Error while calling Pulse SubmitResponse API"),null}}async registerEvent(e,t){try{(await fetch("".concat(this.host,"/pulse/v1/event"),{method:"POST",redirect:"error",headers:{Accept:"application/json","Content-Type":"application/json","anti-csrftoken-a2z":this.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({questionId:e,surveyClient:b,eventType:t,eventMetadata:{mons_site:g(),mons_app:h(),url:v(),targeting_event_id:w()}})})).ok||d("Error submitting event","Error submitting question response")}catch(n){d(n,"Error while calling Pulse RegisterEvent API")}}}class y{constructor(t,n){e(this,"modal",void 0),e(this,"title",void 0),this.modal=t,this.title=n}handlers(){var e=this;return{"vibes-open":function(){(arguments.length<=0?void 0:arguments[0])&&(e.title.innerText=arguments.length<=0?void 0:arguments[0]),e.modal.classList.add("vibes-modal-visible"),o("targeting",!0)},"vibes-close":()=>{this.modal.classList.remove("vibes-modal-visible")},"vibes-refused-targeting":()=>{o("targeting",!1)},default:()=>{}}}}class E{constructor(t,n){e(this,"window",void 0),e(this,"handlers",void 0),this.window=t,this.handlers=n}init(){this.window.addEventListener("message",(e=>{if(!e.data.source||"Vibes"!=e.data.source)return;if(!e.data.action)throw new Error("Event posted to Vibes sent to without valid action");const t=e.data.args;if(!Array.isArray(t))throw new Error("Action ".concat(e.data.action," posted to Vibes sent to without valid args"));e.data.action in this.handlers?this.handlers[e.data.action](...t):this.handlers.default(...t)}))}}async function S(e,t,n,o){const s="T3"===await async function(){return"complete"===document.readyState||"interactive"===document.readyState?l(window.document):new Promise((e=>{document.addEventListener("readystatechange",(t=>{const n=t.target.readyState;"complete"!==n&&"interactive"!==n||e(l(window.document))}))}))}()?"experimental-treatment":"default-treatment",i=document.createElement("div");i.id="vibes-modal-container";const r=document.createElement("div");r.id="vibes-modal-window",r.classList.add(s),r.setAttribute("tab-index","-1"),r.setAttribute("aria-role","dialog"),r.setAttribute("aria-modal","true"),r.setAttribute("aria-labeledby","vibes-modal-title");const a=document.createElement("div");a.id="vibes-modal-header";const c=document.createElement("h3");c.id="vibes-modal-title",c.innerText="We love feedback!";const u=document.createElement("button");u.id="vibes-close-button",u.innerHTML='<span class="vibes-close-button-caption">Close</span>';const d=document.createElement("div");d.id="vibes-modal-content";const p=document.createElement("iframe");p.id="vibes-modal-iframe";let m="".concat("/gp/vibes/form","?w=").concat(e);n&&(m="".concat("/gp/vibes/form","?w=pulse"),window.pulseQuestion=n),o&&(window.pulseEventId=o),t&&(m+="&askMeLater=true"),p.src=m,p.onload=()=>{P(p)},d.appendChild(p),a.appendChild(c),a.appendChild(u),r.appendChild(a),r.appendChild(d),i.appendChild(r);const w=t=>{p.contentWindow&&p.contentWindow.postMessage({action:"close",source:"Vibes",args:[e]},"*"),(null!=t?t:i).classList.remove("vibes-modal-visible")};return u.addEventListener("click",(()=>{w()})),r.addEventListener("keydown",(e=>{"Escape"===e.code&&w()})),i.addEventListener("click",(e=>{const t=e.target;"vibes-modal-container"===t.id&&w(t)})),[i,p,c]}async function I(e,t,n,o){const i=(r=document,a="https://d1qhz7cfyjhrcf.cloudfront.net",c=s,new Promise(((e,t)=>{const n=r.createElement("link");n.onload=()=>e(),n.onerror=e=>t(e),n.setAttribute("rel","stylesheet"),n.setAttribute("href","".concat(a,"/").concat(c)),r.getElementsByTagName("head")[0].appendChild(n)})));var r,a,c;const[l,u,d]=await S(e,t,n,o),p=new y(l,d),m=new E(window,p.handlers());await i,function(e,t,n){e.addEventListener("close",(()=>{t.contentWindow&&t.contentWindow.postMessage({action:"close",source:"Vibes",args:[n]},"*")})),document.body.appendChild(e)}(l,u,e),m.init()}async function O(){try{const e=window.location.search,t=new URLSearchParams(e),n=t.get("debugVibesWorkflow"),o=t.get("debugVibesAskMeLater");if(n)return void(await I(n,!!o,null,null));console.log("Initializing Vibes Host File"),window.vibesState={},await async function(){const e=new u(window.localStorage);if(e.get("pulse-cooldown"))return;const t=new f("",c()),n=await t.getQuestion();n&&n.question&&(e.set("pulse-cooldown","true",36e5),await I("pulse",n.isInCooldown,n.question,n.eventTargetingId||null))}()}catch(e){window.ueLogError?window.ueLogError(e,{logLevel:"ERROR",attribution:"Vibes",message:"Unexpected exception caught while running Vibes"}):console.error("Error initializing Vibes host: ",e)}}function P(e){if(e.contentWindow){const t={};window.pulseQuestion&&(t.pulseQuestion=window.pulseQuestion),window.pulseEventId&&(t.eventId=window.pulseEventId),t.csrfToken=c(),t.parentRequestId=function(){const e=window.parent.document.querySelector('meta[name="a2z:request_id"]');return e&&e.getAttribute("content")||""}(),t.monsSiteName=a(),t.monsAppName=r(),t.currentUrl=function(){const e=window.location;return"".concat(e.protocol,"//").concat(e.host).concat(e.pathname)}(),e.contentWindow.postMessage({action:"setPulseData",source:"Vibes",data:t},"*")}}!async function(){await O()}(),window.addEventListener("message",(e=>{if(e.data&&"VibesIframe"===e.data.source&&"requestPulseData"===e.data.action){const e=document.getElementById("vibes-modal-iframe");e&&P(e)}}))})();
//# sourceMappingURL=vibes_host.efaa4d67.js.map